"use strict";(()=>{var e={};e.id=541,e.ids=[541],e.modules={7096:e=>{e.exports=require("bcrypt")},1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6424:(e,r,a)=>{a.r(r),a.d(r,{config:()=>m,default:()=>p,routeModule:()=>w});var t={};a.r(t),a.d(t,{default:()=>handler});var s=a(1802),o=a(7153),n=a(6249),i=a(7096),d=a.n(i),u=a(1553),l=a(3163);async function handler(e,r){if("GET"==e.method){let a=e.query.email;if(!e.query.email)return r.status(400).json({error:"이메일을 입력하시오"});try{let e=await (0,l.Ft)(),t=(0,u.Z)(e),s=await t.findOne({email:a});if(s)return r.status(404).json({error:"아이디가 이미 존재합니다"});r.status(200).json({message:"성공"})}catch(e){console.error("Error connecting to MongoDB:",e),r.status(500).json({error:"Internal server error"})}}else if("POST"==e.method)try{let a=await d().hash(e.body.password,10);e.body.password=a;let t=await (0,l.Ft)(),s=(0,u.Z)(t),o=new s(e.body),n=await o.save();r.status(200).json(n)}catch(e){console.error("Error occurred:",e),r.status(500).json({message:"err.message"})}else if("PUT"==e.method)try{if(e.query.password){let{email:a,password:t,newPassword:s}=e.body,o=await (0,l.Ft)(),n=(0,u.Z)(o),i=await n.findOne({email:a});if(!i){r.status(404).json({message:"User not found"});return}let p=await d().compare(t,i.password);if(!p)throw Error("Invalid password");let m=await d().hash(s,10),w=await n.findOneAndUpdate({email:a},{password:m},{new:!0});if(!w){r.status(404).json({message:"User update failed"});return}r.status(200).json(w)}else if(e.query.name){let{email:a,password:t,name:s}=e.body,o=await (0,l.Ft)(),n=(0,u.Z)(o),i=await n.findOne({email:a});if(!i){r.status(404).json({message:"User not found"});return}let p=await d().compare(t,i.password);if(!p)throw Error("Invalid password");let m=await n.findOneAndUpdate({email:a},{name:s},{new:!0});if(!m){r.status(404).json({message:"User update failed"});return}r.status(200).json(m)}}catch(e){console.error("Error occurred:",e),r.status(500).json({message:"err.message"})}}let p=(0,n.l)(t,"default"),m=(0,n.l)(t,"config"),w=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/user",pathname:"/api/user",bundlePath:"",filename:""},userland:t})},1553:(e,r,a)=>{a.d(r,{Z:()=>o});var t=a(1185);let s=new t.Schema({email:{type:String,required:!0},password:{type:String,required:!0},name:{type:String,required:!0}});function loginModel(e){return e.model("Login",s)}let o=loginModel}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[222,163],()=>__webpack_exec__(6424));module.exports=a})();